---
import ImagePreview from '@components/blocks/ImagePreview.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('project');
---

<section class='projects'>
	<h1>Projects</h1>
	<p>
		Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorem porro, vitae aliquam illum recusandae,
		architecto iste doloremque suscipit, natus nemo voluptates eum. Dolor suscipit tenetur repellendus est fuga, eos
		cumque!
	</p>
	<ul class='projects-list'>
		{
			allProjects.map(async (project) => {
				const { title, techs, previewImages, liveUrl, sourceUrl } = project.data;
				const { Content } = await project.render();

				return (
					<li>
						<h2>{title}</h2>
						<Content />
						<a href={liveUrl}>Live site</a>
						<a href={sourceUrl}>Source code</a>
						<div class='previews'>
							{previewImages.map((imgSrc, i) => (
								<ImagePreview
									src={`images/projects/${project.slug}/${imgSrc}`}
									alt={`${title} preview #${i + 1}`}
								/>
							))}
						</div>
					</li>
				);
			})
		}
	</ul>
	<p>Check out the <a href='#'>rest of them</a>.</p>
</section>
